---

# 🚀 Cloudflare Worker 多项目部署管理器 (V6.8)

这是一个运行在 Cloudflare Worker 上的高级部署与管理工具，专为管理多个 Cloudflare 账号下的 Worker 项目（如 EdgeTunnel、CFNew 等）而设计。它集成了代码自动部署、变量管理、流量监控、熔断保护和多端适配等功能，是批量管理节点的终极解决方案。

<img width="1660" height="631" alt="image" src="https://github.com/user-attachments/assets/19d76662-04e1-4279-aa38-d8bae78e1d85" />
<img width="1690" height="885" alt="image" src="https://github.com/user-attachments/assets/82832d18-ba3f-49ca-8a3c-5ac0e305d18a" />


## ✨ 主要功能

### 1. 📡 多账号集中管理

* **无限账号支持**：在一个面板内管理无数个 Cloudflare 账号。
* **统一视图**：直观展示所有账号的 Worker 分配情况。
* **流量监控**：实时获取每个账号的今日请求量、总限额（10w/天）及使用百分比。
* **智能排序**：账号列表自动按**流量使用量降序排列**，优先关注高负载账号。

### 2. 🛠️ 深度变量管理

* **自动读取 (Auto-Load)**：点击编辑账号时，**自动无感读取**线上 Worker 的当前配置变量。
* **完全铺开展示**：变量列表不再折叠，自适应高度完全铺开，便于查看大量配置。
* **一键同步 (Sync Select)**：支持从任意已配置的账号读取变量配置，一键应用到当前账号（支持选择同步源）。
* **真实删除**：在线上变量列表中点击删除，不仅删除变量，还会**自动从 GitHub 拉取最新纯净代码重新部署**，彻底清除残留。

### 3. 🚀 自动化与部署

* **一键部署**：支持一键将 GitHub 仓库的最新代码部署到指定账号的 Worker。
* **自动更新**：配合 Cron 定时任务，自动检测上游代码更新并同步。
* **全局熔断保护**：设置流量阈值（如 80%），当账号流量超过阈值时，自动轮换 UUID 并重新部署，防止被封或超量。

### 4. 📱 极致 UI/UX 体验

* **响应式设计**：完美适配 PC 和 手机端。手机端表格支持横向滑动，布局自动堆叠。
* **布局记忆**：支持“左右分栏”和“上下分栏”两种布局，系统自动记住您的选择。
* **All-in-One 编辑**：在同一个弹窗内完成改名、换 Token、看流量、改变量等所有操作。

---

## ⚙️ 部署指南

### 第一步：准备工作

1. 拥有一个 Cloudflare 账号。
2. 准备好需要管理的子账号的 **Account ID** 和 **API Token**。
* *API Token 权限要求：Workers Scripts (Edit), Account Settings (Read), User Details (Read).*



### 第二步：创建 Worker

1. 在 Cloudflare Dashboard 创建一个新的 Worker。
2. 将 `_worker.js` (V6.8) 的所有代码复制并粘贴到 Worker 的编辑器中。
3. 保存并部署。

### 第三步：配置 KV 存储 (必须)

1. 在 Cloudflare 侧栏选择 **Workers & Pages** -> **KV**。
2. 创建一个新的命名空间，建议命名为 `CONFIG_KV`。
3. 回到你创建的 Worker -> **Settings (设置)** -> **Variables (变量)** -> **KV Namespace Bindings**。
4. 点击 **Add binding**：
* **Variable name (变量名)**: `CONFIG_KV` (必须完全一致)
* **KV Namespace**: 选择刚才创建的命名空间。


5. 保存并部署。

### 第四步：设置环境变量 (可选但推荐)

在 Worker 的 **Settings** -> **Variables** -> **Environment Variables** 中添加：

* **ACCESS_CODE**: 设置一个访问密码（例如 `123456`）。设置后，访问网页需要输入密码或在 URL 后加 `?code=密码`。
* **GITHUB_TOKEN**: (可选) 如果你请求 GitHub API 频繁，建议填入 GitHub Personal Access Token 以提高速率限制。

---

## ⏰ Cron 定时任务设置

为了实现**自动更新**和**熔断保护**功能，你需要配置 Cron 触发器。

1. 进入 Worker 的 **Settings** -> **Triggers (触发器)**。
2. 点击 **Add Cron Trigger**。
3. 添加一个时间计划，例如每 30 分钟执行一次：
* **Cron expression**: `*/30 * * * *`


4. 保存。

**在网页端配置自动任务：**
部署完成后，打开网页，在顶部状态栏中：

1. 开启 **"自动检测"** 开关。
2. 设置频率（例如 30 分钟，需与 Cloudflare Cron 设置相符或为其倍数）。
3. 设置 **熔断阈值**（例如 `80`，代表 80%）。填 `0` 则关闭熔断功能。
4. 点击 **"保存"**。

---

## 📖 使用说明

### 添加账号

1. 点击 **"➕ 添加账号"**。
2. 填写 **备注** (Alias)、**Account ID**、**API Token**。
3. 在 **Worker 分配** 栏填写该账号下对应的 Worker 名称（多个名称用逗号分隔）。
* *红色框填 CMliu 系列项目的 Worker 名。*
* *蓝色框填 Joey 系列项目的 Worker 名。*


4. 点击保存。

### 变量管理与同步

* **修改变量**：点击列表右侧的 **"✎"**，在弹出的面板下方会自动加载线上变量，直接修改文本框内容即可。
* **删除变量**：点击变量右侧的 **🗑️** 图标。**注意：** 这会触发代码重拉取和重部署，请耐心等待几秒。
* **同步配置**：在右侧项目配置卡片中，点击 **"🔄 同步"**，选择一个已配置好的账号，将其变量模板复制过来。

---

## ⚠️ 注意事项

1. **API 权限**：请确保提供的 API Token 拥有足够的权限修改 Worker 脚本和读取账号统计信息，否则流量统计和部署将失败。
2. **变量删除机制**：在 V6.8 中，删除变量的操作**不是**单纯删除配置，而是“读取剩余变量 + 从 GitHub 拉取最新代码 + 重新部署”。这是为了防止 Cloudflare 缓存旧代码元数据导致语法错误。
3. **熔断原理**：当流量达到设定阈值（如 80%），脚本会自动为该账号下的 Worker 生成新的 UUID 并重新部署，从而阻断旧链接的流量攻击。
4. **KV 绑定名**：代码中写死了 KV 绑定的变量名为 `CONFIG_KV`，请勿在 Cloudflare 后台绑定为其他名字，否则无法保存数据。
